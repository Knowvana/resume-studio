<div x-show="activeTab === 'editor'" class="view-wrapper animate-fade">
    <div class="theme-panel no-print" x-show="showThemePanel" @click.outside="showThemePanel = false" x-transition style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0 fw-bold text-white">Advanced Settings</h6>
            <button @click="showThemePanel = false" class="btn btn-sm btn-link text-white-50 p-0"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="mb-4">
            <label class="form-label small fw-bold text-uppercase text-white-50">Sidebar Color</label>
            <div class="d-flex flex-column gap-2">
                <div class="d-flex align-items-center gap-2">
                    <input type="color" class="form-control form-control-color w-100" x-model="resume.theme.sidebar_color" style="height: 38px; border:none; padding:2px;" title="Pick any custom color">
                </div>
                <div class="d-flex flex-wrap gap-2 justify-content-start px-1">
                    <div @click="resume.theme.sidebar_color = '#0b1120'" style="width:20px; height:20px; background:#0b1120; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                    <div @click="resume.theme.sidebar_color = '#1e293b'" style="width:20px; height:20px; background:#1e293b; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                    <div @click="resume.theme.sidebar_color = '#374151'" style="width:20px; height:20px; background:#374151; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                    <div @click="resume.theme.sidebar_color = '#172554'" style="width:20px; height:20px; background:#172554; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                    <div @click="resume.theme.sidebar_color = '#7f1d1d'" style="width:20px; height:20px; background:#7f1d1d; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                    <div @click="resume.theme.sidebar_color = '#14532d'" style="width:20px; height:20px; background:#14532d; border-radius:50%; cursor:pointer; border:2px solid #555;"></div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label class="form-label small fw-bold text-uppercase text-white-50">Typography</label>
            <select class="form-select form-select-sm" x-model="resume.theme.font">
                <option value="'Lato', sans-serif">Lato (Clean)</option>
                <option value="'Roboto', sans-serif">Roboto (Modern)</option>
                <option value="'Open Sans', sans-serif">Open Sans (Standard)</option>
                <option value="'Montserrat', sans-serif">Montserrat (Geometric)</option>
                <option value="'Playfair Display', serif">Playfair Display (Serif)</option>
            </select>
        </div>
        
        <div class="border-top border-secondary pt-3 mt-2">
            <button @click="resetThemeOnly()" class="btn btn-sm btn-outline-light w-100 opacity-75"><i class="fas fa-undo me-2"></i>Reset Styling</button>
        </div>
    </div>

    <div class="container pb-5">
        <div class="theme-fab no-print" @click="showThemePanel = !showThemePanel" title="More Settings"><i class="fas fa-palette fs-4"></i></div>
        
        <div class="resume-paper row g-0" :style="'font-family: ' + resume.theme.font">
            
            <div class="col-lg-4 sidebar-wrapper text-center text-lg-start" :style="'background-color: ' + (resume.theme.sidebar_color || '#0b1120')">
                 <div class="profile-img-box mb-4" @click="promptImage()">
                    <template x-if="resume.profile.image"><img :src="resume.profile.image"></template>
                    <template x-if="!resume.profile.image"><img :src="defaultImage"></template>
                </div>
                <div class="mb-5 text-center">
                    <textarea x-model="resume.profile.name" class="form-control-ghost form-control-ghost-dark text-center font-serif-bold sidebar-name no-print" placeholder="Your Name" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                    <div class="print-only font-serif-bold sidebar-name text-center" x-text="resume.profile.name"></div>
                    
                    <textarea x-model="resume.profile.tagline" class="form-control-ghost form-control-ghost-dark text-center text-uppercase sidebar-role no-print" placeholder="Role Title" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                    <div class="print-only text-uppercase sidebar-role text-center" x-text="resume.profile.tagline"></div>
                </div>
                
                <div class="section-group">
                    <div class="sidebar-header">Contact Details</div>
                    <div class="contact-row">
                        <i class="fas fa-map-marker-alt contact-icon"></i>
                        <textarea x-model="resume.profile.location" class="form-control-ghost form-control-ghost-dark contact-input no-print" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                        <div class="print-only contact-input" x-text="resume.profile.location"></div>
                    </div>
                    <div class="contact-row">
                        <i class="fas fa-phone contact-icon"></i>
                        <textarea x-model="resume.profile.phone" class="form-control-ghost form-control-ghost-dark contact-input no-print" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                        <div class="print-only contact-input" x-text="resume.profile.phone"></div>
                    </div>
                    <div class="contact-row">
                        <a :href="'mailto:'+resume.profile.email" class="text-white"><i class="fas fa-envelope contact-icon"></i></a>
                        <textarea x-model="resume.profile.email" class="form-control-ghost form-control-ghost-dark contact-input no-print" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                        <div class="print-only contact-input" x-text="resume.profile.email"></div>
                    </div>
                    <div class="contact-row">
                        <a :href="resume.profile.linkedin" target="_blank" class="text-white"><i class="fab fa-linkedin contact-icon"></i></a>
                        <textarea x-model="resume.profile.linkedin" class="form-control-ghost form-control-ghost-dark contact-input no-print" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                        <div class="print-only contact-input" x-text="resume.profile.linkedin"></div>
                    </div>
                </div>

                <div class="section-group">
                    <div class="sidebar-header d-flex justify-content-between align-items-center"><span>Certifications</span><button @click="addItem('certifications')" class="btn btn-sm btn-link text-white-50 p-0 no-print"><i class="fas fa-plus small"></i></button></div>
                    <template x-for="(cert, index) in resume.certifications" :key="index">
                        <div class="mb-3 group-hover position-relative">
                            <button @click="removeItem('certifications', index)" class="btn btn-link text-danger p-0 position-absolute top-0 end-0 no-print opacity-50 hover-100" style="font-size:0.7rem"><i class="fas fa-times"></i></button>
                            <div class="d-flex align-items-start mb-1 justify-content-start">
                                <i :class="cert.icon || 'fas fa-certificate'" class="text-warning small me-2 mt-1 cursor-pointer" style="width: 15px; text-align:center; flex-shrink: 0;" @click="promptIcon(cert)" title="Click to change icon"></i>
                                <div class="w-100">
                                    <textarea x-model="cert.name" class="form-control-ghost form-control-ghost-dark fw-bold small p-0 no-print" placeholder="Name" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                    <div class="print-only fw-bold small text-white" style="line-height: 1.2;" x-text="cert.name"></div>
                                    
                                    <div class="d-flex gap-1 mt-1 align-items-center">
                                        <input x-model="cert.start" class="form-control-ghost form-control-ghost-dark small p-0 text-white-50" style="font-size: 0.75rem; width: 60px;" placeholder="Start">
                                        <span class="text-white-50 small">-</span>
                                        <input x-model="cert.end" class="form-control-ghost form-control-ghost-dark small p-0 text-white-50" style="font-size: 0.75rem; width: 60px;" placeholder="End">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <div class="section-group">
                    <div class="sidebar-header mt-5 d-flex justify-content-between align-items-center"><span>Core Competencies</span><button @click="addItem('skills')" class="btn btn-sm btn-outline-light border-0 py-0 no-print opacity-50"><i class="fas fa-folder-plus"></i></button></div>
                    <template x-for="(cat, cIndex) in resume.skills" :key="cIndex">
                        <div class="mb-4 skill-category-wrapper">
                            <div class="d-flex justify-content-between align-items-center">
                                <input x-model="cat.category" class="form-control-ghost form-control-ghost-dark skill-category-input" placeholder="CATEGORY">
                                <div class="no-print">
                                    <button @click="addSkillItem(cIndex)" class="btn btn-sm btn-link text-white-50 p-0"><i class="fas fa-plus small"></i></button>
                                    <button @click="resume.skills.splice(cIndex, 1)" class="btn btn-sm btn-link text-danger p-0 ms-1"><i class="fas fa-times small"></i></button>
                                </div>
                            </div>
                            <template x-for="(skill, sIndex) in cat.list" :key="sIndex">
                                <div class="skill-item-row group-hover">
                                    <input x-model="skill.name" class="form-control-ghost form-control-ghost-dark skill-name-input no-print" placeholder="Skill">
                                    <div class="print-only skill-name-text" x-text="skill.name"></div>
                                    <div class="skill-bar-wrapper">
                                        <template x-for="level in 5">
                                            <div class="skill-dot" :class="{'filled': level <= skill.level}" @click.stop="skill.level = level"></div>
                                        </template>
                                    </div>
                                    <i @click="cat.list.splice(sIndex, 1)" class="fas fa-minus-circle text-danger ms-1 small cursor-pointer opacity-0 hover-100 no-print"></i>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>

            <div class="col-lg-8 main-content-wrapper">
                
                <div class="mb-5 section-group">
                    <h2 class="section-title">Professional Profile</h2>
                    <div class="beautiful-separator"></div>
                    <div class="form-control-wrapper position-relative w-100">
                        <div class="no-print" x-data="richText(resume.profile.summary, (val) => resume.profile.summary = val)">
                            <div x-ref="quillEditor" style="min-height: 100px; background:white;"></div>
                        </div>
                        <div class="print-only mb-4 text-muted fs-5 ql-editor" x-html="resume.profile.summary"></div>
                    </div>
                    
                    <div class="highlight-box">
                        <div class="highlight-text-bg">
                            <i class="fas fa-quote-left text-secondary mb-2"></i>
                            <div class="form-control-wrapper position-relative">
                                <div class="no-print" x-data="richText(resume.profile.impact_statement, (val) => resume.profile.impact_statement = val)">
                                    <div x-ref="quillEditor" style="min-height: 80px; background:white;"></div>
                                </div>
                                <div class="print-only impact-font text-center ql-editor" x-html="resume.profile.impact_statement"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-5 section-group">
                    <div class="d-flex justify-content-between align-items-end mb-2"><h2 class="section-title mb-0">Signature Achievements</h2><button @click="addItem('signature_achievements')" class="btn btn-sm text-primary no-print">+ Add Card</button></div>
                    <div class="beautiful-separator"></div>
                    <div class="row g-3">
                        <template x-for="(ach, index) in resume.signature_achievements" :key="index">
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm position-relative group-hover achievement-card">
                                    <button @click="removeItem('signature_achievements', index)" class="btn btn-remove-card no-print"><i class="fas fa-times"></i></button>
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-start mb-3">
                                            <div class="flex-grow-1 me-3">
                                                <textarea x-model="ach.title" class="form-control-ghost fw-bold text-dark fs-5 w-100 no-print" placeholder="Title" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                                <div class="print-only fw-bold text-dark fs-5" x-text="ach.title"></div>
                                            </div>
                                            <div class="text-warning fs-4 flex-shrink-0"><i :class="ach.icon || 'fas fa-star'"></i></div>
                                        </div>
                                        
                                        <div class="no-print" x-data="richText(ach.description, (val) => ach.description = val)">
                                            <div x-ref="quillEditor" style="min-height: 100px; background:white;"></div>
                                        </div>
                                        <div class="print-only text-muted ql-editor" x-html="ach.description"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="mb-5 section-group">
                    <div class="d-flex justify-content-between align-items-end mb-2"><h2 class="section-title mb-0">Experience</h2><button @click="addItem('experience')" class="btn btn-sm text-primary no-print">+ Role</button></div>
                    <div class="beautiful-separator"></div>
                    <div class="timeline-container">
                        <div class="timeline-badge-top">Current</div>
                        <div class="timeline-badge-bottom">Start</div>
                        <template x-for="(job, index) in resume.experience" :key="index">
                            <div class="timeline-item section-group">
                                <div class="timeline-icon"></div>
                                <div class="row mb-1 align-items-baseline">
                                    <div class="col-8">
                                        <textarea x-model="job.role" class="form-control-ghost timeline-role no-print" placeholder="Role Title" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                        <div class="print-only timeline-role" x-text="job.role"></div>
                                    </div>
                                    <div class="col-4 text-end">
                                        <div class="timeline-date print-only"><span x-text="formatDate(job.startDate)"></span> - <span x-text="job.isCurrent ? 'Present' : formatDate(job.endDate)"></span></div>
                                        <div class="no-print d-flex flex-column align-items-end gap-1">
                                            <div class="d-flex gap-1 align-items-center"><input type="month" x-model="job.startDate" class="date-picker-modern"><span class="small text-muted">-</span><input type="month" x-model="job.endDate" class="date-picker-modern" x-show="!job.isCurrent"><span class="badge bg-success" x-show="job.isCurrent">Present</span></div>
                                            <div class="form-check small"><input type="checkbox" class="form-check-input" :id="'curr'+index" x-model="job.isCurrent"><label class="form-check-label text-muted" :for="'curr'+index">Currently Working</label></div>
                                        </div>
                                    </div>
                                </div>
                                <textarea x-model="job.company" class="form-control-ghost timeline-company no-print" placeholder="Company Name" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                <div class="print-only timeline-company" x-text="job.company"></div>
                                
                                <div class="mt-3">
                                    <div class="no-print w-100" x-data="richText(job.achievements, (val) => job.achievements = val)">
                                        <div x-ref="quillEditor" style="background:white; min-height: 100px;"></div>
                                    </div>
                                    <div class="print-only ql-editor" x-html="job.achievements"></div>
                                </div>
                                
                                <div class="text-end mt-2 no-print">
                                    <button @click="removeItem('experience', index)" class="btn btn-sm btn-link text-danger p-0" title="Remove Role"><i class="fas fa-trash"></i> Remove Role</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="mb-5 section-group">
                    <div class="d-flex justify-content-between align-items-end mb-2"><h2 class="section-title mb-0">Education</h2><button @click="addItem('education')" class="btn btn-sm text-primary no-print">+ Add</button></div>
                    <div class="beautiful-separator"></div>
                    <div class="timeline-container">
                        <template x-for="(edu, index) in resume.education" :key="index">
                            <div class="timeline-item pb-4 section-group">
                                <div class="timeline-icon"></div>
                                <div class="row mb-1 align-items-baseline">
                                    <div class="col-8">
                                        <textarea x-model="edu.degree" class="form-control-ghost timeline-role fs-5 no-print" placeholder="Degree" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                        <div class="print-only timeline-role fs-5" x-text="edu.degree"></div>
                                    </div>
                                    <div class="col-4 text-end">
                                        <div class="timeline-date print-only"><span x-text="formatDate(edu.startDate)"></span> - <span x-text="formatDate(edu.endDate)"></span></div>
                                        <div class="no-print d-flex justify-content-end align-items-center gap-1">
                                            <input type="month" x-model="edu.startDate" class="date-picker-modern"><span class="small text-muted">-</span><input type="month" x-model="edu.endDate" class="date-picker-modern">
                                        </div>
                                    </div>
                                </div>
                                <textarea x-model="edu.institution" class="form-control-ghost timeline-company text-muted no-print" placeholder="Institution" rows="1" @input="resize($event.target)" x-init="resize($el)"></textarea>
                                <div class="print-only timeline-company text-muted" x-text="edu.institution"></div>
                                
                                <div class="no-print mt-2" x-data="richText(edu.details, (val) => edu.details = val)">
                                    <div x-ref="quillEditor" style="background:white; min-height: 60px;"></div>
                                </div>
                                <div class="print-only text-muted small mt-2 ql-editor" x-html="edu.details"></div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="mb-5 section-group">
                    <h2 class="section-title">Personal Details</h2>
                    <div class="beautiful-separator"></div>
                    <div class="personal-details-card">
                        <div class="row g-4">
                            <div class="col-md-4"><span class="pd-label">Date of Birth</span><input x-model="resume.personal_details.dob" type="date" class="form-control-ghost pd-value"></div>
                            <div class="col-md-4"><span class="pd-label">Nationality</span><select x-model="resume.personal_details.nationality" class="form-control-ghost pd-value"><option>Indian</option><option>American</option><option>British</option><option>German</option></select></div>
                            <div class="col-md-4"><span class="pd-label">Marital Status</span><select x-model="resume.personal_details.marital_status" class="form-control-ghost pd-value"><option>Single</option><option>Married</option></select></div>
                            <div class="col-12">
                                <div class="d-flex justify-content-between"><span class="pd-label">Languages</span><button @click="resume.personal_details.languages.push('')" class="btn btn-sm text-primary py-0 no-print">+ Add</button></div>
                                <div class="d-flex flex-wrap gap-2 mt-2">
                                    <template x-for="(lang, i) in resume.personal_details.languages" :key="i">
                                        <div class="bg-light px-3 py-1 rounded-pill border d-flex align-items-center"><input x-model="resume.personal_details.languages[i]" class="form-control-ghost p-0 fw-bold small text-center" style="width: 80px;"><i @click="resume.personal_details.languages.splice(i, 1)" class="fas fa-times text-danger ms-2 cursor-pointer no-print small"></i></div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <template x-for="(section, sIndex) in resume.custom_sections" :key="sIndex">
                    <div class="mb-5 position-relative group-hover section-group">
                        <button @click="removeItem('custom_sections', sIndex)" class="btn btn-sm text-danger position-absolute top-0 end-0 no-print"><i class="fas fa-trash"></i></button>
                        <input x-model="section.title" class="form-control-ghost section-title mb-2" placeholder="Section Title">
                        <div class="beautiful-separator"></div>
                        <ul class="list-unstyled detail-list text-muted ps-2">
                            <template x-for="(item, iIndex) in section.content" :key="iIndex">
                                 <li class="d-flex mb-2 align-items-start">
                                    <div class="no-print w-100" x-data="richText(section.content[iIndex], (val) => section.content[iIndex] = val)">
                                        <div x-ref="quillEditor" style="background:white;"></div>
                                    </div>
                                    <div class="print-only w-100 ql-editor" x-html="section.content[iIndex]"></div>
                                    <button @click="section.content.splice(iIndex, 1)" class="btn btn-link text-danger p-0 ms-2 small no-print"><i class="fas fa-minus-circle"></i></button>
                                </li>
                            </template>
                        </ul>
                        <button @click="section.content.push('')" class="btn btn-sm btn-link text-primary no-print ms-4 ps-3"><i class="fas fa-plus-circle me-1"></i> Add Point</button>
                    </div>
                </template>
                <div class="text-center mt-5 no-print"><button @click="addItem('custom_sections')" class="btn btn-outline-primary px-4 rounded-pill"><i class="fas fa-plus me-2"></i> Add Custom Section</button></div>
            </div>
        </div>
        <footer class="app-footer no-print"><div class="container"><p class="mb-1">&copy; 2026 Resume Architect</p></div></footer>
    </div>
</div>